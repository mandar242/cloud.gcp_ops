---
- name: Create storage bucket
  google.cloud.gcp_storage_bucket:
    name: "{{ test_bucket_name }}"
    project: "{{ test_project_name }}"
    auth_kind: serviceaccount
    service_account_file: "{{ test_auth_pem_file }}"
    state: present

- name: Upload function source zip to bucket
  google.cloud.gcp_storage_object:
    action: upload
    bucket: "{{ test_bucket_name }}"
    project: "{{ test_project_name }}"
    src: "{{ lookup('file', 'flask-cloud-func-source.zip') }}"
    dest: "flask-cloud-func-source.zip"
    auth_kind: serviceaccount
    service_account_file: "{{ test_auth_pem_file }}"
